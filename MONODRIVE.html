<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MonoDrive Pro</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --fg: #ffffff;
            --accent: #444;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: var(--fg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            touch-action: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 100%;
            max-height: 900px;
            background: var(--bg);
            overflow: hidden;
            box-shadow: 0 0 50px rgba(255,255,255,0.1);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 5;
        }

        .score-box {
            text-align: left;
        }

        #scoreVal {
            font-size: 2rem;
            font-weight: 800;
            display: block;
        }

        .multiplier {
            font-size: 0.8rem;
            color: #888;
            letter-spacing: 2px;
        }

        #boost-container {
            width: 120px;
            text-align: right;
        }

        .bar-bg {
            width: 100%;
            height: 6px;
            background: #222;
            margin-top: 5px;
            border-radius: 3px;
            overflow: hidden;
        }

        #boost-bar {
            width: 0%;
            height: 100%;
            background: #fff;
            box-shadow: 0 0 10px #fff;
        }

        #menu, #game-over {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.3s;
        }

        h1 { font-size: 2.5rem; font-weight: 900; margin: 0; letter-spacing: -1px; }
        .subtitle { color: #666; margin-bottom: 30px; font-size: 0.9rem; }

        button {
            background: #fff;
            border: none;
            color: #000;
            padding: 18px 45px;
            font-size: 1rem;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.95); }

        .hidden { opacity: 0; pointer-events: none; }

        #msg-overlay {
            position: absolute;
            top: 40%;
            width: 100%;
            text-align: center;
            font-weight: 900;
            font-size: 1.5rem;
            pointer-events: none;
            color: #fff;
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
        }

        .pop { opacity: 1 !important; transform: scale(1.2); }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="ui">
            <div class="score-box">
                <span id="scoreVal">0</span>
                <span class="multiplier" id="multiVal">1.0x SPEED</span>
            </div>
            <div id="boost-container">
                <span style="font-size: 0.7rem; font-weight: 700;">NITRO</span>
                <div class="bar-bg"><div id="boost-bar"></div></div>
            </div>
        </div>

        <div id="msg-overlay">PERFECT PASS</div>

        <div id="menu">
            <h1>MONO<span style="color:#666">DRIVE</span></h1>
            <p class="subtitle">TAP SIDES TO STEER â€¢ COLLECT WHITE ORBS</p>
            <button id="startBtn">Drive</button>
        </div>

        <div id="game-over" class="hidden">
            <h1 id="crashText">CRASHED</h1>
            <p class="subtitle" id="finalStats">SCORE: 0</p>
            <button id="restartBtn">Retry</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreVal = document.getElementById('scoreVal');
        const multiVal = document.getElementById('multiVal');
        const boostBar = document.getElementById('boost-bar');
        const msgOverlay = document.getElementById('msg-overlay');
        
        let width, height;
        let gameActive = false;
        let score = 0;
        let baseSpeed = 6;
        let speedMult = 1;
        let nitro = 0;
        let isNitro = false;
        let frame = 0;
        let shake = 0;
        let lastPassId = -1;

        const player = {
            x: 0,
            y: 0,
            w: 34,
            h: 64,
            targetX: 0,
            rot: 0,
            history: []
        };

        let entities = [];
        let particles = [];

        function resize() {
            width = canvas.width = canvas.offsetWidth;
            height = canvas.height = canvas.offsetHeight;
            player.x = width / 2;
            player.y = height - 150;
            player.targetX = player.x;
        }
        window.onresize = resize;
        resize();

        const input = { left: false, right: false };
        const handleInput = (code, val) => {
            if (['ArrowLeft', 'KeyA'].includes(code)) input.left = val;
            if (['ArrowRight', 'KeyD'].includes(code)) input.right = val;
        };

        window.onkeydown = e => handleInput(e.code, true);
        window.onkeyup = e => handleInput(e.code, false);
        
        canvas.ontouchstart = e => {
            const x = e.touches[0].clientX;
            if (x < window.innerWidth / 2) input.left = true;
            else input.right = true;
        };
        canvas.ontouchend = () => { input.left = false; input.right = false; };

        function spawnParticle(x, y, color = '#fff', count = 5) {
            for(let i=0; i<count; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1,
                    color
                });
            }
        }

        function showMessage(txt) {
            msgOverlay.innerText = txt;
            msgOverlay.classList.add('pop');
            setTimeout(() => msgOverlay.classList.remove('pop'), 600);
        }

        function init() {
            score = 0;
            baseSpeed = 7;
            speedMult = 1;
            nitro = 0;
            isNitro = false;
            entities = [];
            particles = [];
            player.history = [];
            frame = 0;
            gameActive = true;
            resize();
        }

        function update() {
            if (!gameActive) return;
            frame++;

            // Movement
            const steer = 0.15;
            if (input.left) player.targetX -= 10;
            if (input.right) player.targetX += 10;
            player.targetX = Math.max(50, Math.min(width - 50, player.targetX));
            
            const prevX = player.x;
            player.x += (player.targetX - player.x) * steer;
            player.rot = (player.x - prevX) * 0.05;

            // Trail
            if (frame % 2 === 0) {
                player.history.unshift({x: player.x, y: player.y});
                if (player.history.length > 10) player.history.pop();
            }

            // Speed & Nitro
            if (nitro > 0 && isNitro) {
                speedMult = 2.5;
                nitro -= 0.6;
                shake = Math.max(shake, 2);
                if (nitro <= 0) isNitro = false;
            } else {
                speedMult = Math.min(2, 1 + (score / 10000));
            }

            const currentSpeed = baseSpeed * speedMult;
            score += Math.round(currentSpeed / 2);
            scoreVal.innerText = score.toLocaleString();
            multiVal.innerText = speedMult.toFixed(1) + "x SPEED";
            boostBar.style.width = nitro + "%";

            // Spawning
            if (frame % Math.max(15, 60 - Math.floor(score/1000)) === 0) {
                entities.push({
                    id: frame,
                    type: 'car',
                    x: Math.random() * (width - 100) + 50,
                    y: -100,
                    w: 34,
                    h: 64,
                    color: '#333',
                    passed: false
                });
            }
            if (frame % 200 === 0) {
                entities.push({ type: 'nitro', x: Math.random() * (width - 100) + 50, y: -100, size: 15 });
            }

            // Entities update
            for (let i = entities.length - 1; i >= 0; i--) {
                const e = entities[i];
                e.y += currentSpeed;

                // Collision
                const dx = Math.abs(player.x - e.x);
                const dy = Math.abs(player.y - e.y);

                if (e.type === 'car') {
                    // Check for Close Pass (Dopamine hit)
                    if (!e.passed && dy < 50 && dx < 60 && dx > 35) {
                        e.passed = true;
                        score += 500;
                        nitro = Math.min(100, nitro + 10);
                        showMessage("PERFECT PASS!");
                        spawnParticle(e.x, e.y, '#fff', 3);
                    }

                    if (dx < 30 && dy < 60) {
                        if (isNitro) {
                            spawnParticle(e.x, e.y, '#fff', 15);
                            entities.splice(i, 1);
                            score += 1000;
                            shake = 10;
                        } else {
                            gameActive = false;
                            shake = 20;
                            document.getElementById('game-over').classList.remove('hidden');
                            document.getElementById('finalStats').innerText = "SCORE: " + score.toLocaleString();
                        }
                    }
                } else if (e.type === 'nitro') {
                    if (dx < 40 && dy < 40) {
                        nitro = 100;
                        isNitro = true;
                        entities.splice(i, 1);
                        showMessage("NITRO!!!");
                        spawnParticle(player.x, player.y, '#fff', 20);
                    }
                }

                if (e.y > height + 100) entities.splice(i, 1);
            }

            // Particles
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.02;
                if (p.life <= 0) particles.splice(i, 1);
            });

            if (shake > 0) shake *= 0.9;
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            ctx.save();
            if (shake > 0) {
                ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
            }

            // Road Lines
            ctx.strokeStyle = '#1a1a1a';
            ctx.lineWidth = 4;
            const lineGap = 100;
            const lineOffset = (frame * (baseSpeed * speedMult)) % lineGap;
            for(let y = -lineGap; y < height + lineGap; y += lineGap) {
                ctx.beginPath();
                ctx.moveTo(width/3, y + lineOffset); ctx.lineTo(width/3, y + lineOffset + 40);
                ctx.moveTo(2*width/3, y + lineOffset); ctx.lineTo(2*width/3, y + lineOffset + 40);
                ctx.stroke();
            }

            // Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 4, 4);
            });
            ctx.globalAlpha = 1;

            // Player Trail
            player.history.forEach((pos, i) => {
                ctx.globalAlpha = (1 - i / player.history.length) * 0.3;
                drawCar(pos.x, pos.y, player.w, player.h, player.rot, '#fff');
            });
            ctx.globalAlpha = 1;

            // Entities
            entities.forEach(e => {
                if (e.type === 'car') {
                    drawCar(e.x, e.y, e.w, e.h, 0, e.color);
                } else {
                    ctx.fillStyle = '#fff';
                    ctx.beginPath();
                    ctx.arc(e.x, e.y, 10 + Math.sin(frame/5)*5, 0, Math.PI*2);
                    ctx.fill();
                    // Glow
                    ctx.globalAlpha = 0.3;
                    ctx.beginPath();
                    ctx.arc(e.x, e.y, 20 + Math.sin(frame/5)*10, 0, Math.PI*2);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
            });

            // Player
            if (isNitro) {
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#fff';
            }
            drawCar(player.x, player.y, player.w, player.h, player.rot, '#fff');
            ctx.shadowBlur = 0;

            ctx.restore();

            requestAnimationFrame(() => {
                update();
                draw();
            });
        }

        function drawCar(x, y, w, h, r, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(r);
            
            // Body
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.roundRect(-w/2, -h/2, w, h, 4);
            ctx.fill();

            // Windshield
            ctx.fillStyle = color === '#fff' ? '#000' : '#555';
            ctx.fillRect(-w/2 + 4, -h/2 + 10, w - 8, 15);
            
            // Lights
            if (color === '#fff') {
                ctx.fillStyle = '#fff';
                ctx.fillRect(-w/2 + 4, -h/2, 6, 2);
                ctx.fillRect(w/2 - 10, -h/2, 6, 2);
            }

            ctx.restore();
        }

        document.getElementById('startBtn').onclick = () => {
            document.getElementById('menu').classList.add('hidden');
            init();
        };

        document.getElementById('restartBtn').onclick = () => {
            document.getElementById('game-over').classList.add('hidden');
            init();
        };

        draw();
    </script>
</body>
</html>

